
<div class="container-cave">
  <div class="cave-page-title">
    <h1> Mes caves </h1>
  </div>
  <div class="create-cave-link">
    <%= link_to '<i class="fas fa-plus"></i>'.html_safe, new_cave_path, id:"favicon-add-cave" %>
  </div>
</div>

<% @caves.each do |cave| %>

  <%= link_to cave_path(cave) do %>
    <div class="cave-card">
      <% if cave.photo.attached? %>
        <%= cl_image_tag cave.photo.key, alt: "personnal cave", class: "card-cave-img"%>
      <% else %>
        <%= image_tag "https://source.unsplash.com/300x200/?cellar-wine", class: "card-cave-img" %>
      <% end %>

      <div class="cave-card-info">
        <div class="cave-name">
          <h3> <%= cave.name %> </h3>
          <div class="cave-position-edit-favicon">
            <%= link_to '<i class="far fa-edit"></i>'.html_safe, edit_cave_path(cave), id:"cave-favicon" %>
          </div>
        </div>

        <div class="cave-card-element">

          <% red_count = cave.bottles.joins(:wine).where(wines: {color: 'Rouge'}).sum(:quantity) %>

          <% if red_count > 0 %>
            <div class="cave-bottle-count">
              <div class="red-bottles">
                <%= image_tag('red-bottle.png', alt: "red wine bottle", class:"cave-card-little-bottle") %>
              </div>
                <div class="bottle-count">
                    <p><%= red_count %></p>
                </div>
            </div>
          <% end %>

          <% pink_count = cave.bottles.joins(:wine).where(wines: {color: 'RosÃ©'}).sum(:quantity) %>

          <% if pink_count > 0 %>
            <div class="cave-bottle-count">
              <div class="rose-bottles-count">
                <%= image_tag('rose-bottle.png', alt: "rose wine bottle", class:"cave-card-little-bottle") %>
              </div>
              <div class="bottle-count">
                  <p><%= pink_count %></p>
              </div>
            </div>
          <% end %>

          <% white_count = cave.bottles.joins(:wine).where(wines: {color: 'Blanc'}).sum(:quantity) %>

          <% if white_count > 0  %>
            <div class="cave-bottle-count">
              <div class="white-bottles-count">
                <%= image_tag('white-bottle.png', alt: "white wine bottle", class:"cave-card-little-bottle") %>
              </div>
              <div class="bottle-count">
                  <p><%= white_count %></p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
