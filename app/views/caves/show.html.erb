<div class="cave-page-title">
  <h1><%= @cave.name %></h1>
</div>

<%= form_tag cave_path(@cave), class: "search-bar", method: :get do %>
  <%= select_tag "meal", options_from_collection_for_select(@meals, "id", "name"), include_blank: true , class: "meal-filter"%>
  <%= submit_tag "Chercher!", class: "my-btn search-btn", data: {turbolinks: "false"} %>
<% end %>

<% if @bottles.empty? %>
  <div class="empty-cave">
    <div class="empty-cave-content">
      <p>Votre cave est vide</p>
      <%= link_to "Add some bottles", wines_path, class: 'add-bottle' %>
    </div>
  </div>

  <% else %>
  <% @bottles.each do |bottle| %>
    <% unless bottle.quantity == 0 %>
      <div class="cave-show-wine-card">

        <div class="wine-image">
          <%= cl_image_tag bottle.wine.photo.key, class: "cave-show-wine-img" %>

        </div>

        <div class="cave-show-wine-information">
          <div class="cave-show-wine-title">
            <h1><strong><%= bottle.wine.name %></strong></h1>
            <div class="take-bottle-out">
              <%= link_to '<i class="fas fa-minus"></i>'.html_safe, edit_bottle_path(bottle), id:"favicon-add-cave" %>
            </div>
          </div>
          <div class="cave-show-wine-description">
            <h3> <strong>Region:</strong> <%= bottle.wine.appelation.region.name %> </h3>
            <h3> <strong>Appelation:</strong> <%= bottle.wine.appelation.name %> </h3>
            <h3> <strong>Qty: <%= bottle.quantity %> </strong></h3>
          </div>

          <% now_diff = Time.now.year - bottle.wine.apogee_start %>
          <% apogee_duration = bottle.wine.apogee_end - bottle.wine.apogee_start %>
          <% percentage = (apogee_duration == 0) ? 100 : (now_diff.to_f/apogee_duration)*100 %>

          <div class="wine-apogee">
          <h3><%= bottle.wine.apogee_start %></h3>
          <div class="progress">
            <div class="progress-bar" style="width:<%= percentage.to_i %>%;" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
            </div>
          </div>
          <h3><%= bottle.wine.apogee_end %></h3>
        </div>
        </div>

      </div>
    <% end %>
  <% end %>
<% end %>



